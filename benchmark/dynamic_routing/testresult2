bash run_benchmark.sh --arch raw  --benchmark memory_plan --memory-mode predict
['.', '/home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing', '/home/v-weihaocui/brainstorm_project/brainstorm/3rdparty/tvm/python', '/home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python38.zip', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/lib-dynload', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages', '/home/v-weihaocui/brainstorm_project/brainstorm/python', '/home/v-weihaocui/brainstorm_project/brainstorm/3rdparty/dynamic_routing', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pycocotools-2.0.6-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/portalocker-2.6.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard-2.11.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/shapely-2.0rc1-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/matplotlib-3.6.2-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tabulate-0.9.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/termcolor-2.1.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/wheel-0.38.4-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/Werkzeug-2.2.2-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard_plugin_wit-1.8.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard_data_server-0.6.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/Markdown-3.4.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/grpcio-1.51.1-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/google_auth-2.14.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/google_auth_oauthlib-0.4.6-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/absl_py-1.3.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/kiwisolver-1.4.4-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/fonttools-4.38.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/cycler-0.11.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/contourpy-1.0.6-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/rsa-4.9-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pyasn1_modules-0.3.0rc1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/cachetools-5.2.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/requests_oauthlib-1.3.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pyasn1-0.5.0rc2-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/oauthlib-3.2.2-py3.8.egg']
Command Line Args: Namespace(arch='raw', benchmark=['memory_plan'], debug=False, dist_url='tcp://127.0.0.1:62896', eval_only=False, machine_rank=0, memory_mode='predict', num_gpus=1, num_machines=1, opts=[], resume=False)
[12/07 09:41:29 dl_lib]: Rank of current process: 0. World size: 1
[12/07 09:41:29 dl_lib]: Command line arguments: Namespace(arch='raw', benchmark=['memory_plan'], debug=False, dist_url='tcp://127.0.0.1:62896', eval_only=False, machine_rank=0, memory_mode='predict', num_gpus=1, num_machines=1, opts=[], resume=False)
[12/07 09:41:31 c2.utils.checkpoint]: Loading checkpoint from /home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing/../../.cache/ckpt/dynamic_routing/dynamic_raw_miou76_7.pth
[12/07 09:41:32 c2.data.detection_utils]: TransformGens used: [ResizeShortestEdge(short_edge_length=(1024, 1024), max_size=2048, sample_style='choice')]
[12/07 09:41:32 c2.evaluation.evaluator]: Start inference on 500 images
[12/07 09:41:50 c2.evaluation.evaluator]: Inference done 50/500. 0.3122 s / img. ETA=0:02:20
[12/07 09:42:05 c2.evaluation.evaluator]: Inference done 100/500. 0.3078 s / img. ETA=0:02:03
[12/07 09:42:21 c2.evaluation.evaluator]: Inference done 150/500. 0.3133 s / img. ETA=0:01:49
[12/07 09:42:38 c2.evaluation.evaluator]: Inference done 200/500. 0.3188 s / img. ETA=0:01:35
[12/07 09:42:54 c2.evaluation.evaluator]: Inference done 250/500. 0.3211 s / img. ETA=0:01:20
[12/07 09:43:11 c2.evaluation.evaluator]: Inference done 300/500. 0.3231 s / img. ETA=0:01:04
[12/07 09:43:27 c2.evaluation.evaluator]: Inference done 350/500. 0.3233 s / img. ETA=0:00:48
[12/07 09:43:43 c2.evaluation.evaluator]: Inference done 400/500. 0.3232 s / img. ETA=0:00:32
[12/07 09:43:59 c2.evaluation.evaluator]: Inference done 450/500. 0.3221 s / img. ETA=0:00:16
[12/07 09:44:13 c2.evaluation.evaluator]: Inference done 500/500. 0.3184 s / img. ETA=0:00:00
[12/07 09:44:13 c2.evaluation.evaluator]: Total inference time: 0:02:37 (0.317172 s / img per device, on 1 devices)
[12/07 09:44:13 c2.evaluation.evaluator]: Total inference pure compute time: 0:01:03 (0.129018 s / img per device, on 1 devices)
[12/07 09:44:14 c2.evaluation.sem_seg_evaluation]: OrderedDict([('sem_seg', {'mIoU': 76.66681621952162, 'fwIoU': 92.85563391131222, 'mACC': 84.68712574459461, 'pACC': 96.14714208097736})])
[12/07 09:44:14 c2.engine.custom]: Evaluation results for cityscapes_fine_sem_seg_val in csv format:
[12/07 09:44:14 c2.evaluation.testing]: copypaste: Task: sem_seg
[12/07 09:44:14 c2.evaluation.testing]: copypaste: mIoU,fwIoU,mACC,pACC
[12/07 09:44:14 c2.evaluation.testing]: copypaste: 76.6668,92.8556,84.6871,96.1471
naive test results in ms: avg: 94.705 max: 94.928 min: 94.490
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   94765 KB |  619053 KB |    1225 GB |    1225 GB |
|       from large pool |   24576 KB |  548864 KB |    1223 GB |    1223 GB |
|       from small pool |   70189 KB |   70975 KB |       1 GB |       1 GB |
|---------------------------------------------------------------------------|
| Active memory         |   94765 KB |  619053 KB |    1225 GB |    1225 GB |
|       from large pool |   24576 KB |  548864 KB |    1223 GB |    1223 GB |
|       from small pool |   70189 KB |   70975 KB |       1 GB |       1 GB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  641024 KB |  641024 KB |  544768 KB |       0 B  |
|       from large pool |  569344 KB |  569344 KB |  544768 KB |       0 B  |
|       from small pool |   71680 KB |   71680 KB |       0 KB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1491 KB |  337363 KB |    1211 GB |    1211 GB |
|       from large pool |       0 KB |  335872 KB |    1209 GB |    1209 GB |
|       from small pool |    1491 KB |    1491 KB |       1 GB |       1 GB |
|---------------------------------------------------------------------------|
| Allocations           |    1935    |    1964    |  126995    |  126995    |
|       from large pool |       1    |      28    |   86790    |   86790    |
|       from small pool |    1934    |    1938    |   40205    |   40205    |
|---------------------------------------------------------------------------|
| Active allocs         |    1935    |    1964    |  126995    |  126995    |
|       from large pool |       1    |      28    |   86790    |   86790    |
|       from small pool |    1934    |    1938    |   40205    |   40205    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      41    |      41    |       5    |       0    |
|       from large pool |       6    |       6    |       5    |       0    |
|       from small pool |      35    |      35    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |      14    |   68695    |   68695    |
|       from large pool |       0    |      13    |   51260    |   51260    |
|       from small pool |       1    |       3    |   17435    |   17435    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before profile
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   84487 KB |   84487 KB |       0 B  |       0 B  |
|       from large pool |   53983 KB |   53983 KB |       0 B  |       0 B  |
|       from small pool |   30504 KB |   30504 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   84487 KB |   84487 KB |       0 B  |       0 B  |
|       from large pool |   53983 KB |   53983 KB |       0 B  |       0 B  |
|       from small pool |   30504 KB |   30504 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  641024 KB |  641024 KB |       0 B  |       0 B  |
|       from large pool |  569344 KB |  569344 KB |       0 B  |       0 B  |
|       from small pool |   71680 KB |   71680 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  124409 KB |  124409 KB |       0 B  |       0 B  |
|       from large pool |  122145 KB |  122145 KB |       0 B  |       0 B  |
|       from small pool |    2264 KB |    2264 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Allocations           |     177    |     177    |       0    |       0    |
|       from large pool |      15    |      15    |       0    |       0    |
|       from small pool |     162    |     162    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     177    |     177    |       0    |       0    |
|       from large pool |      15    |      15    |       0    |       0    |
|       from small pool |     162    |     162    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      41    |      41    |       0    |       0    |
|       from large pool |       6    |       6    |       0    |       0    |
|       from small pool |      35    |      35    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      18    |      18    |       0    |       0    |
|       from large pool |       2    |       2    |       0    |       0    |
|       from small pool |      16    |      16    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

PredictorMemoryPlanPass test results in ms: avg: 122.248 max: 122.807 min: 121.820
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   84487 KB |  349711 KB |    1082 GB |    1082 GB |
|       from large pool |   53983 KB |  319207 KB |    1081 GB |    1081 GB |
|       from small pool |   30504 KB |   31290 KB |       1 GB |       1 GB |
|---------------------------------------------------------------------------|
| Active memory         |   84487 KB |  349711 KB |    1082 GB |    1082 GB |
|       from large pool |   53983 KB |  319207 KB |    1081 GB |    1081 GB |
|       from small pool |   30504 KB |   31290 KB |       1 GB |       1 GB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  641024 KB |  641024 KB |       0 B  |       0 B  |
|       from large pool |  569344 KB |  569344 KB |       0 B  |       0 B  |
|       from small pool |   71680 KB |   71680 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  124409 KB |  284153 KB |    1050 GB |    1050 GB |
|       from large pool |  122145 KB |  281889 KB |    1049 GB |    1049 GB |
|       from small pool |    2264 KB |    2264 KB |       1 GB |       1 GB |
|---------------------------------------------------------------------------|
| Allocations           |     177    |     189    |  113135    |  113135    |
|       from large pool |      15    |      26    |   71500    |   71500    |
|       from small pool |     162    |     165    |   41635    |   41635    |
|---------------------------------------------------------------------------|
| Active allocs         |     177    |     189    |  113135    |  113135    |
|       from large pool |      15    |      26    |   71500    |   71500    |
|       from small pool |     162    |     165    |   41635    |   41635    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      41    |      41    |       0    |       0    |
|       from large pool |       6    |       6    |       0    |       0    |
|       from small pool |      35    |      35    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      18    |      25    |   68970    |   68970    |
|       from large pool |       2    |       9    |   34485    |   34485    |
|       from small pool |      16    |      17    |   34485    |   34485    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

bash run_benchmark.sh --arch raw  --benchmark memory_plan --memory-mode on_demand
['.', '/home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing', '/home/v-weihaocui/brainstorm_project/brainstorm/3rdparty/tvm/python', '/home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python38.zip', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/lib-dynload', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages', '/home/v-weihaocui/brainstorm_project/brainstorm/python', '/home/v-weihaocui/brainstorm_project/brainstorm/3rdparty/dynamic_routing', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pycocotools-2.0.6-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/portalocker-2.6.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard-2.11.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/shapely-2.0rc1-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/matplotlib-3.6.2-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tabulate-0.9.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/termcolor-2.1.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/wheel-0.38.4-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/Werkzeug-2.2.2-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard_plugin_wit-1.8.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard_data_server-0.6.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/Markdown-3.4.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/grpcio-1.51.1-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/google_auth-2.14.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/google_auth_oauthlib-0.4.6-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/absl_py-1.3.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/kiwisolver-1.4.4-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/fonttools-4.38.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/cycler-0.11.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/contourpy-1.0.6-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/rsa-4.9-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pyasn1_modules-0.3.0rc1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/cachetools-5.2.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/requests_oauthlib-1.3.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pyasn1-0.5.0rc2-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/oauthlib-3.2.2-py3.8.egg']
Command Line Args: Namespace(arch='raw', benchmark=['memory_plan'], debug=False, dist_url='tcp://127.0.0.1:62896', eval_only=False, machine_rank=0, memory_mode='on_demand', num_gpus=1, num_machines=1, opts=[], resume=False)
[12/07 09:44:47 dl_lib]: Rank of current process: 0. World size: 1
[12/07 09:44:47 dl_lib]: Command line arguments: Namespace(arch='raw', benchmark=['memory_plan'], debug=False, dist_url='tcp://127.0.0.1:62896', eval_only=False, machine_rank=0, memory_mode='on_demand', num_gpus=1, num_machines=1, opts=[], resume=False)
[12/07 09:44:49 c2.utils.checkpoint]: Loading checkpoint from /home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing/../../.cache/ckpt/dynamic_routing/dynamic_raw_miou76_7.pth
[12/07 09:44:50 c2.data.detection_utils]: TransformGens used: [ResizeShortestEdge(short_edge_length=(1024, 1024), max_size=2048, sample_style='choice')]
[12/07 09:44:51 c2.evaluation.evaluator]: Start inference on 500 images
[12/07 09:45:07 c2.evaluation.evaluator]: Inference done 50/500. 0.3006 s / img. ETA=0:02:15
[12/07 09:45:23 c2.evaluation.evaluator]: Inference done 100/500. 0.3067 s / img. ETA=0:02:02
[12/07 09:45:39 c2.evaluation.evaluator]: Inference done 150/500. 0.3134 s / img. ETA=0:01:49
[12/07 09:45:56 c2.evaluation.evaluator]: Inference done 200/500. 0.3177 s / img. ETA=0:01:35
[12/07 09:46:13 c2.evaluation.evaluator]: Inference done 250/500. 0.3211 s / img. ETA=0:01:20
[12/07 09:46:30 c2.evaluation.evaluator]: Inference done 300/500. 0.3255 s / img. ETA=0:01:05
[12/07 09:46:46 c2.evaluation.evaluator]: Inference done 350/500. 0.3257 s / img. ETA=0:00:48
[12/07 09:47:02 c2.evaluation.evaluator]: Inference done 400/500. 0.3247 s / img. ETA=0:00:32
[12/07 09:47:18 c2.evaluation.evaluator]: Inference done 450/500. 0.3235 s / img. ETA=0:00:16
[12/07 09:47:33 c2.evaluation.evaluator]: Inference done 500/500. 0.3207 s / img. ETA=0:00:00
[12/07 09:47:33 c2.evaluation.evaluator]: Total inference time: 0:02:38 (0.319192 s / img per device, on 1 devices)
[12/07 09:47:33 c2.evaluation.evaluator]: Total inference pure compute time: 0:01:04 (0.130108 s / img per device, on 1 devices)
[12/07 09:47:33 c2.evaluation.sem_seg_evaluation]: OrderedDict([('sem_seg', {'mIoU': 76.66681621952162, 'fwIoU': 92.85563391131222, 'mACC': 84.68712574459461, 'pACC': 96.14714208097736})])
[12/07 09:47:33 c2.engine.custom]: Evaluation results for cityscapes_fine_sem_seg_val in csv format:
[12/07 09:47:33 c2.evaluation.testing]: copypaste: Task: sem_seg
[12/07 09:47:33 c2.evaluation.testing]: copypaste: mIoU,fwIoU,mACC,pACC
[12/07 09:47:33 c2.evaluation.testing]: copypaste: 76.6668,92.8556,84.6871,96.1471
naive test results in ms: avg: 96.963 max: 97.319 min: 96.650
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   94765 KB |  619053 KB |    1225 GB |    1225 GB |
|       from large pool |   24576 KB |  548864 KB |    1223 GB |    1223 GB |
|       from small pool |   70189 KB |   70975 KB |       1 GB |       1 GB |
|---------------------------------------------------------------------------|
| Active memory         |   94765 KB |  619053 KB |    1225 GB |    1225 GB |
|       from large pool |   24576 KB |  548864 KB |    1223 GB |    1223 GB |
|       from small pool |   70189 KB |   70975 KB |       1 GB |       1 GB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  641024 KB |  641024 KB |  544768 KB |       0 B  |
|       from large pool |  569344 KB |  569344 KB |  544768 KB |       0 B  |
|       from small pool |   71680 KB |   71680 KB |       0 KB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1491 KB |  337363 KB |    1211 GB |    1211 GB |
|       from large pool |       0 KB |  335872 KB |    1209 GB |    1209 GB |
|       from small pool |    1491 KB |    1491 KB |       1 GB |       1 GB |
|---------------------------------------------------------------------------|
| Allocations           |    1935    |    1964    |  126995    |  126995    |
|       from large pool |       1    |      28    |   86790    |   86790    |
|       from small pool |    1934    |    1938    |   40205    |   40205    |
|---------------------------------------------------------------------------|
| Active allocs         |    1935    |    1964    |  126995    |  126995    |
|       from large pool |       1    |      28    |   86790    |   86790    |
|       from small pool |    1934    |    1938    |   40205    |   40205    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      41    |      41    |       5    |       0    |
|       from large pool |       6    |       6    |       5    |       0    |
|       from small pool |      35    |      35    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |      14    |   68695    |   68695    |
|       from large pool |       0    |      13    |   51260    |   51260    |
|       from small pool |       1    |       3    |   17435    |   17435    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before profile
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   84487 KB |   84487 KB |       0 B  |       0 B  |
|       from large pool |   53983 KB |   53983 KB |       0 B  |       0 B  |
|       from small pool |   30504 KB |   30504 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   84487 KB |   84487 KB |       0 B  |       0 B  |
|       from large pool |   53983 KB |   53983 KB |       0 B  |       0 B  |
|       from small pool |   30504 KB |   30504 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  641024 KB |  641024 KB |       0 B  |       0 B  |
|       from large pool |  569344 KB |  569344 KB |       0 B  |       0 B  |
|       from small pool |   71680 KB |   71680 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  124409 KB |  124409 KB |       0 B  |       0 B  |
|       from large pool |  122145 KB |  122145 KB |       0 B  |       0 B  |
|       from small pool |    2264 KB |    2264 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Allocations           |     177    |     177    |       0    |       0    |
|       from large pool |      15    |      15    |       0    |       0    |
|       from small pool |     162    |     162    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     177    |     177    |       0    |       0    |
|       from large pool |      15    |      15    |       0    |       0    |
|       from small pool |     162    |     162    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      41    |      41    |       0    |       0    |
|       from large pool |       6    |       6    |       0    |       0    |
|       from small pool |      35    |      35    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      18    |      18    |       0    |       0    |
|       from large pool |       2    |       2    |       0    |       0    |
|       from small pool |      16    |      16    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

OnDemandMemoryPlanPass test results in ms: avg: 127.005 max: 127.690 min: 126.539
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   84487 KB |  349711 KB |    1082 GB |    1082 GB |
|       from large pool |   53983 KB |  319207 KB |    1081 GB |    1081 GB |
|       from small pool |   30504 KB |   31290 KB |       1 GB |       1 GB |
|---------------------------------------------------------------------------|
| Active memory         |   84487 KB |  349711 KB |    1082 GB |    1082 GB |
|       from large pool |   53983 KB |  319207 KB |    1081 GB |    1081 GB |
|       from small pool |   30504 KB |   31290 KB |       1 GB |       1 GB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  641024 KB |  641024 KB |       0 B  |       0 B  |
|       from large pool |  569344 KB |  569344 KB |       0 B  |       0 B  |
|       from small pool |   71680 KB |   71680 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  124409 KB |  284153 KB |    1050 GB |    1050 GB |
|       from large pool |  122145 KB |  281889 KB |    1049 GB |    1049 GB |
|       from small pool |    2264 KB |    2264 KB |       1 GB |       1 GB |
|---------------------------------------------------------------------------|
| Allocations           |     177    |     189    |  113135    |  113135    |
|       from large pool |      15    |      26    |   71500    |   71500    |
|       from small pool |     162    |     165    |   41635    |   41635    |
|---------------------------------------------------------------------------|
| Active allocs         |     177    |     189    |  113135    |  113135    |
|       from large pool |      15    |      26    |   71500    |   71500    |
|       from small pool |     162    |     165    |   41635    |   41635    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      41    |      41    |       0    |       0    |
|       from large pool |       6    |       6    |       0    |       0    |
|       from small pool |      35    |      35    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      18    |      25    |   68970    |   68970    |
|       from large pool |       2    |       9    |   34485    |   34485    |
|       from small pool |      16    |      17    |   34485    |   34485    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

bash run_benchmark.sh --arch A  --benchmark memory_plan --memory-mode predict
['.', '/home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing', '/home/v-weihaocui/brainstorm_project/brainstorm/3rdparty/tvm/python', '/home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python38.zip', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/lib-dynload', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages', '/home/v-weihaocui/brainstorm_project/brainstorm/python', '/home/v-weihaocui/brainstorm_project/brainstorm/3rdparty/dynamic_routing', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pycocotools-2.0.6-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/portalocker-2.6.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard-2.11.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/shapely-2.0rc1-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/matplotlib-3.6.2-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tabulate-0.9.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/termcolor-2.1.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/wheel-0.38.4-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/Werkzeug-2.2.2-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard_plugin_wit-1.8.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard_data_server-0.6.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/Markdown-3.4.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/grpcio-1.51.1-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/google_auth-2.14.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/google_auth_oauthlib-0.4.6-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/absl_py-1.3.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/kiwisolver-1.4.4-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/fonttools-4.38.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/cycler-0.11.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/contourpy-1.0.6-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/rsa-4.9-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pyasn1_modules-0.3.0rc1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/cachetools-5.2.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/requests_oauthlib-1.3.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pyasn1-0.5.0rc2-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/oauthlib-3.2.2-py3.8.egg']
Command Line Args: Namespace(arch='A', benchmark=['memory_plan'], debug=False, dist_url='tcp://127.0.0.1:62896', eval_only=False, machine_rank=0, memory_mode='predict', num_gpus=1, num_machines=1, opts=[], resume=False)
[12/07 09:48:07 dl_lib]: Rank of current process: 0. World size: 1
[12/07 09:48:07 dl_lib]: Command line arguments: Namespace(arch='A', benchmark=['memory_plan'], debug=False, dist_url='tcp://127.0.0.1:62896', eval_only=False, machine_rank=0, memory_mode='predict', num_gpus=1, num_machines=1, opts=[], resume=False)
[12/07 09:48:09 c2.utils.checkpoint]: Loading checkpoint from /home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing/../../.cache/ckpt/dynamic_routing/dynamic_A_miou73_9.pth
[12/07 09:48:10 c2.data.detection_utils]: TransformGens used: [ResizeShortestEdge(short_edge_length=(1024, 1024), max_size=2048, sample_style='choice')]
[12/07 09:48:11 c2.evaluation.evaluator]: Start inference on 500 images
[12/07 09:48:27 c2.evaluation.evaluator]: Inference done 50/500. 0.2817 s / img. ETA=0:02:06
[12/07 09:48:41 c2.evaluation.evaluator]: Inference done 100/500. 0.2829 s / img. ETA=0:01:53
[12/07 09:48:55 c2.evaluation.evaluator]: Inference done 150/500. 0.2814 s / img. ETA=0:01:38
[12/07 09:49:09 c2.evaluation.evaluator]: Inference done 200/500. 0.2819 s / img. ETA=0:01:24
[12/07 09:49:24 c2.evaluation.evaluator]: Inference done 250/500. 0.2837 s / img. ETA=0:01:10
[12/07 09:49:39 c2.evaluation.evaluator]: Inference done 300/500. 0.2886 s / img. ETA=0:00:57
[12/07 09:49:54 c2.evaluation.evaluator]: Inference done 350/500. 0.2883 s / img. ETA=0:00:43
[12/07 09:50:08 c2.evaluation.evaluator]: Inference done 400/500. 0.2894 s / img. ETA=0:00:28
[12/07 09:50:23 c2.evaluation.evaluator]: Inference done 450/500. 0.2897 s / img. ETA=0:00:14
[12/07 09:50:37 c2.evaluation.evaluator]: Inference done 500/500. 0.2877 s / img. ETA=0:00:00
[12/07 09:50:37 c2.evaluation.evaluator]: Total inference time: 0:02:22 (0.286869 s / img per device, on 1 devices)
[12/07 09:50:37 c2.evaluation.evaluator]: Total inference pure compute time: 0:00:53 (0.107525 s / img per device, on 1 devices)
[12/07 09:50:37 c2.evaluation.sem_seg_evaluation]: OrderedDict([('sem_seg', {'mIoU': 73.92052971450491, 'fwIoU': 92.27022401803225, 'mACC': 81.72749777012434, 'pACC': 95.8199222018323})])
[12/07 09:50:37 c2.engine.custom]: Evaluation results for cityscapes_fine_sem_seg_val in csv format:
[12/07 09:50:37 c2.evaluation.testing]: copypaste: Task: sem_seg
[12/07 09:50:37 c2.evaluation.testing]: copypaste: mIoU,fwIoU,mACC,pACC
[12/07 09:50:37 c2.evaluation.testing]: copypaste: 73.9205,92.2702,81.7275,95.8199
naive test results in ms: avg: 74.776 max: 75.243 min: 74.090
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   94765 KB |  619053 KB |  729178 MB |  729178 MB |
|       from large pool |   24576 KB |  548864 KB |  722421 MB |  722421 MB |
|       from small pool |   70189 KB |   72237 KB |    6756 MB |    6756 MB |
|---------------------------------------------------------------------------|
| Active memory         |   94765 KB |  619053 KB |  729178 MB |  729178 MB |
|       from large pool |   24576 KB |  548864 KB |  722421 MB |  722421 MB |
|       from small pool |   70189 KB |   72237 KB |    6756 MB |    6756 MB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  643072 KB |  643072 KB |  546816 KB |       0 B  |
|       from large pool |  569344 KB |  569344 KB |  544768 KB |       0 B  |
|       from small pool |   73728 KB |   73728 KB |    2048 KB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1491 KB |  271827 KB |  719318 MB |  719318 MB |
|       from large pool |       0 KB |  270336 KB |  711021 MB |  711021 MB |
|       from small pool |    1491 KB |    3538 KB |    8296 MB |    8296 MB |
|---------------------------------------------------------------------------|
| Allocations           |    1935    |    1957    |   81840    |   81840    |
|       from large pool |       1    |      19    |   35200    |   35200    |
|       from small pool |    1934    |    1939    |   46640    |   46640    |
|---------------------------------------------------------------------------|
| Active allocs         |    1935    |    1957    |   81840    |   81840    |
|       from large pool |       1    |      19    |   35200    |   35200    |
|       from small pool |    1934    |    1939    |   46640    |   46640    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      42    |      42    |       6    |       0    |
|       from large pool |       6    |       6    |       5    |       0    |
|       from small pool |      36    |      36    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |      10    |   42680    |   42680    |
|       from large pool |       0    |       8    |   21120    |   21120    |
|       from small pool |       1    |       3    |   21560    |   21560    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before profile
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   84487 KB |   84487 KB |       0 B  |       0 B  |
|       from large pool |   53983 KB |   53983 KB |       0 B  |       0 B  |
|       from small pool |   30504 KB |   30504 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   84487 KB |   84487 KB |       0 B  |       0 B  |
|       from large pool |   53983 KB |   53983 KB |       0 B  |       0 B  |
|       from small pool |   30504 KB |   30504 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  643072 KB |  643072 KB |       0 B  |       0 B  |
|       from large pool |  569344 KB |  569344 KB |       0 B  |       0 B  |
|       from small pool |   73728 KB |   73728 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  124409 KB |  124409 KB |       0 B  |       0 B  |
|       from large pool |  122145 KB |  122145 KB |       0 B  |       0 B  |
|       from small pool |    2264 KB |    2264 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Allocations           |     177    |     177    |       0    |       0    |
|       from large pool |      15    |      15    |       0    |       0    |
|       from small pool |     162    |     162    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     177    |     177    |       0    |       0    |
|       from large pool |      15    |      15    |       0    |       0    |
|       from small pool |     162    |     162    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      42    |      42    |       0    |       0    |
|       from large pool |       6    |       6    |       0    |       0    |
|       from small pool |      36    |      36    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      18    |      18    |       0    |       0    |
|       from large pool |       2    |       2    |       0    |       0    |
|       from small pool |      16    |      16    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

PredictorMemoryPlanPass test results in ms: avg: 101.893 max: 102.487 min: 101.653
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   84487 KB |  349711 KB |  695044 MB |  695044 MB |
|       from large pool |   53983 KB |  319207 KB |  688424 MB |  688424 MB |
|       from small pool |   30504 KB |   32552 KB |    6619 MB |    6619 MB |
|---------------------------------------------------------------------------|
| Active memory         |   84487 KB |  349711 KB |  695044 MB |  695044 MB |
|       from large pool |   53983 KB |  319207 KB |  688424 MB |  688424 MB |
|       from small pool |   30504 KB |   32552 KB |    6619 MB |    6619 MB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  643072 KB |  643072 KB |       0 B  |       0 B  |
|       from large pool |  569344 KB |  569344 KB |       0 B  |       0 B  |
|       from small pool |   73728 KB |   73728 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  124409 KB |  223737 KB |  662759 MB |  662759 MB |
|       from large pool |  122145 KB |  220449 KB |  655424 MB |  655424 MB |
|       from small pool |    2264 KB |    3800 KB |    7334 MB |    7334 MB |
|---------------------------------------------------------------------------|
| Allocations           |     177    |     186    |   76890    |   76890    |
|       from large pool |      15    |      23    |   31020    |   31020    |
|       from small pool |     162    |     165    |   45870    |   45870    |
|---------------------------------------------------------------------------|
| Active allocs         |     177    |     186    |   76890    |   76890    |
|       from large pool |      15    |      23    |   31020    |   31020    |
|       from small pool |     162    |     165    |   45870    |   45870    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      42    |      42    |       0    |       0    |
|       from large pool |       6    |       6    |       0    |       0    |
|       from small pool |      36    |      36    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      18    |      24    |   47410    |   47410    |
|       from large pool |       2    |       7    |   16060    |   16060    |
|       from small pool |      16    |      17    |   31350    |   31350    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

bash run_benchmark.sh --arch A  --benchmark memory_plan --memory-mode on_demand
['.', '/home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing', '/home/v-weihaocui/brainstorm_project/brainstorm/3rdparty/tvm/python', '/home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python38.zip', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/lib-dynload', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages', '/home/v-weihaocui/brainstorm_project/brainstorm/python', '/home/v-weihaocui/brainstorm_project/brainstorm/3rdparty/dynamic_routing', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pycocotools-2.0.6-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/portalocker-2.6.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard-2.11.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/shapely-2.0rc1-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/matplotlib-3.6.2-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tabulate-0.9.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/termcolor-2.1.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/wheel-0.38.4-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/Werkzeug-2.2.2-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard_plugin_wit-1.8.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard_data_server-0.6.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/Markdown-3.4.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/grpcio-1.51.1-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/google_auth-2.14.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/google_auth_oauthlib-0.4.6-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/absl_py-1.3.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/kiwisolver-1.4.4-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/fonttools-4.38.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/cycler-0.11.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/contourpy-1.0.6-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/rsa-4.9-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pyasn1_modules-0.3.0rc1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/cachetools-5.2.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/requests_oauthlib-1.3.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pyasn1-0.5.0rc2-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/oauthlib-3.2.2-py3.8.egg']
Command Line Args: Namespace(arch='A', benchmark=['memory_plan'], debug=False, dist_url='tcp://127.0.0.1:62896', eval_only=False, machine_rank=0, memory_mode='on_demand', num_gpus=1, num_machines=1, opts=[], resume=False)
[12/07 09:51:08 dl_lib]: Rank of current process: 0. World size: 1
[12/07 09:51:08 dl_lib]: Command line arguments: Namespace(arch='A', benchmark=['memory_plan'], debug=False, dist_url='tcp://127.0.0.1:62896', eval_only=False, machine_rank=0, memory_mode='on_demand', num_gpus=1, num_machines=1, opts=[], resume=False)
[12/07 09:51:10 c2.utils.checkpoint]: Loading checkpoint from /home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing/../../.cache/ckpt/dynamic_routing/dynamic_A_miou73_9.pth
[12/07 09:51:11 c2.data.detection_utils]: TransformGens used: [ResizeShortestEdge(short_edge_length=(1024, 1024), max_size=2048, sample_style='choice')]
[12/07 09:51:12 c2.evaluation.evaluator]: Start inference on 500 images
[12/07 09:51:28 c2.evaluation.evaluator]: Inference done 50/500. 0.2944 s / img. ETA=0:02:12
[12/07 09:51:44 c2.evaluation.evaluator]: Inference done 100/500. 0.3092 s / img. ETA=0:02:03
[12/07 09:52:00 c2.evaluation.evaluator]: Inference done 150/500. 0.3099 s / img. ETA=0:01:48
[12/07 09:52:16 c2.evaluation.evaluator]: Inference done 200/500. 0.3117 s / img. ETA=0:01:33
[12/07 09:52:31 c2.evaluation.evaluator]: Inference done 250/500. 0.3118 s / img. ETA=0:01:17
[12/07 09:52:47 c2.evaluation.evaluator]: Inference done 300/500. 0.3126 s / img. ETA=0:01:02
[12/07 09:53:03 c2.evaluation.evaluator]: Inference done 350/500. 0.3116 s / img. ETA=0:00:46
[12/07 09:53:18 c2.evaluation.evaluator]: Inference done 400/500. 0.3101 s / img. ETA=0:00:31
[12/07 09:53:32 c2.evaluation.evaluator]: Inference done 450/500. 0.3082 s / img. ETA=0:00:15
[12/07 09:53:46 c2.evaluation.evaluator]: Inference done 500/500. 0.3040 s / img. ETA=0:00:00
[12/07 09:53:46 c2.evaluation.evaluator]: Total inference time: 0:02:30 (0.303030 s / img per device, on 1 devices)
[12/07 09:53:46 c2.evaluation.evaluator]: Total inference pure compute time: 0:00:52 (0.106180 s / img per device, on 1 devices)
[12/07 09:53:46 c2.evaluation.sem_seg_evaluation]: OrderedDict([('sem_seg', {'mIoU': 73.92052971450491, 'fwIoU': 92.27022401803225, 'mACC': 81.72749777012434, 'pACC': 95.8199222018323})])
[12/07 09:53:46 c2.engine.custom]: Evaluation results for cityscapes_fine_sem_seg_val in csv format:
[12/07 09:53:46 c2.evaluation.testing]: copypaste: Task: sem_seg
[12/07 09:53:46 c2.evaluation.testing]: copypaste: mIoU,fwIoU,mACC,pACC
[12/07 09:53:46 c2.evaluation.testing]: copypaste: 73.9205,92.2702,81.7275,95.8199
naive test results in ms: avg: 74.772 max: 75.342 min: 74.438
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   94765 KB |  619053 KB |  729178 MB |  729178 MB |
|       from large pool |   24576 KB |  548864 KB |  722421 MB |  722421 MB |
|       from small pool |   70189 KB |   72237 KB |    6756 MB |    6756 MB |
|---------------------------------------------------------------------------|
| Active memory         |   94765 KB |  619053 KB |  729178 MB |  729178 MB |
|       from large pool |   24576 KB |  548864 KB |  722421 MB |  722421 MB |
|       from small pool |   70189 KB |   72237 KB |    6756 MB |    6756 MB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  643072 KB |  643072 KB |  546816 KB |       0 B  |
|       from large pool |  569344 KB |  569344 KB |  544768 KB |       0 B  |
|       from small pool |   73728 KB |   73728 KB |    2048 KB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1491 KB |  271827 KB |  719318 MB |  719318 MB |
|       from large pool |       0 KB |  270336 KB |  711021 MB |  711021 MB |
|       from small pool |    1491 KB |    3538 KB |    8296 MB |    8296 MB |
|---------------------------------------------------------------------------|
| Allocations           |    1935    |    1957    |   81840    |   81840    |
|       from large pool |       1    |      19    |   35200    |   35200    |
|       from small pool |    1934    |    1939    |   46640    |   46640    |
|---------------------------------------------------------------------------|
| Active allocs         |    1935    |    1957    |   81840    |   81840    |
|       from large pool |       1    |      19    |   35200    |   35200    |
|       from small pool |    1934    |    1939    |   46640    |   46640    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      42    |      42    |       6    |       0    |
|       from large pool |       6    |       6    |       5    |       0    |
|       from small pool |      36    |      36    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |      10    |   42680    |   42680    |
|       from large pool |       0    |       8    |   21120    |   21120    |
|       from small pool |       1    |       3    |   21560    |   21560    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before profile
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   84487 KB |   84487 KB |       0 B  |       0 B  |
|       from large pool |   53983 KB |   53983 KB |       0 B  |       0 B  |
|       from small pool |   30504 KB |   30504 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   84487 KB |   84487 KB |       0 B  |       0 B  |
|       from large pool |   53983 KB |   53983 KB |       0 B  |       0 B  |
|       from small pool |   30504 KB |   30504 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  643072 KB |  643072 KB |       0 B  |       0 B  |
|       from large pool |  569344 KB |  569344 KB |       0 B  |       0 B  |
|       from small pool |   73728 KB |   73728 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  124409 KB |  124409 KB |       0 B  |       0 B  |
|       from large pool |  122145 KB |  122145 KB |       0 B  |       0 B  |
|       from small pool |    2264 KB |    2264 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Allocations           |     177    |     177    |       0    |       0    |
|       from large pool |      15    |      15    |       0    |       0    |
|       from small pool |     162    |     162    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     177    |     177    |       0    |       0    |
|       from large pool |      15    |      15    |       0    |       0    |
|       from small pool |     162    |     162    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      42    |      42    |       0    |       0    |
|       from large pool |       6    |       6    |       0    |       0    |
|       from small pool |      36    |      36    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      18    |      18    |       0    |       0    |
|       from large pool |       2    |       2    |       0    |       0    |
|       from small pool |      16    |      16    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

OnDemandMemoryPlanPass test results in ms: avg: 102.514 max: 107.936 min: 100.227
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   84487 KB |  349711 KB |  695044 MB |  695044 MB |
|       from large pool |   53983 KB |  319207 KB |  688424 MB |  688424 MB |
|       from small pool |   30504 KB |   32552 KB |    6619 MB |    6619 MB |
|---------------------------------------------------------------------------|
| Active memory         |   84487 KB |  349711 KB |  695044 MB |  695044 MB |
|       from large pool |   53983 KB |  319207 KB |  688424 MB |  688424 MB |
|       from small pool |   30504 KB |   32552 KB |    6619 MB |    6619 MB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  643072 KB |  643072 KB |       0 B  |       0 B  |
|       from large pool |  569344 KB |  569344 KB |       0 B  |       0 B  |
|       from small pool |   73728 KB |   73728 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  124409 KB |  223737 KB |  662759 MB |  662759 MB |
|       from large pool |  122145 KB |  220449 KB |  655424 MB |  655424 MB |
|       from small pool |    2264 KB |    3800 KB |    7334 MB |    7334 MB |
|---------------------------------------------------------------------------|
| Allocations           |     177    |     186    |   76890    |   76890    |
|       from large pool |      15    |      23    |   31020    |   31020    |
|       from small pool |     162    |     165    |   45870    |   45870    |
|---------------------------------------------------------------------------|
| Active allocs         |     177    |     186    |   76890    |   76890    |
|       from large pool |      15    |      23    |   31020    |   31020    |
|       from small pool |     162    |     165    |   45870    |   45870    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      42    |      42    |       0    |       0    |
|       from large pool |       6    |       6    |       0    |       0    |
|       from small pool |      36    |      36    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      18    |      24    |   47410    |   47410    |
|       from large pool |       2    |       7    |   16060    |   16060    |
|       from small pool |      16    |      17    |   31350    |   31350    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

bash run_benchmark.sh --arch B  --benchmark memory_plan --memory-mode predict
['.', '/home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing', '/home/v-weihaocui/brainstorm_project/brainstorm/3rdparty/tvm/python', '/home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python38.zip', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/lib-dynload', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages', '/home/v-weihaocui/brainstorm_project/brainstorm/python', '/home/v-weihaocui/brainstorm_project/brainstorm/3rdparty/dynamic_routing', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pycocotools-2.0.6-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/portalocker-2.6.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard-2.11.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/shapely-2.0rc1-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/matplotlib-3.6.2-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tabulate-0.9.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/termcolor-2.1.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/wheel-0.38.4-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/Werkzeug-2.2.2-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard_plugin_wit-1.8.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard_data_server-0.6.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/Markdown-3.4.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/grpcio-1.51.1-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/google_auth-2.14.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/google_auth_oauthlib-0.4.6-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/absl_py-1.3.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/kiwisolver-1.4.4-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/fonttools-4.38.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/cycler-0.11.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/contourpy-1.0.6-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/rsa-4.9-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pyasn1_modules-0.3.0rc1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/cachetools-5.2.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/requests_oauthlib-1.3.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pyasn1-0.5.0rc2-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/oauthlib-3.2.2-py3.8.egg']
Command Line Args: Namespace(arch='B', benchmark=['memory_plan'], debug=False, dist_url='tcp://127.0.0.1:62896', eval_only=False, machine_rank=0, memory_mode='predict', num_gpus=1, num_machines=1, opts=[], resume=False)
[12/07 09:54:17 dl_lib]: Rank of current process: 0. World size: 1
[12/07 09:54:17 dl_lib]: Command line arguments: Namespace(arch='B', benchmark=['memory_plan'], debug=False, dist_url='tcp://127.0.0.1:62896', eval_only=False, machine_rank=0, memory_mode='predict', num_gpus=1, num_machines=1, opts=[], resume=False)
[12/07 09:54:19 c2.utils.checkpoint]: Loading checkpoint from /home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing/../../.cache/ckpt/dynamic_routing/dynamic_B_miou74_3.pth
[12/07 09:54:21 c2.data.detection_utils]: TransformGens used: [ResizeShortestEdge(short_edge_length=(1024, 1024), max_size=2048, sample_style='choice')]
[12/07 09:54:21 c2.evaluation.evaluator]: Start inference on 500 images
[12/07 09:54:38 c2.evaluation.evaluator]: Inference done 50/500. 0.2989 s / img. ETA=0:02:14
[12/07 09:54:53 c2.evaluation.evaluator]: Inference done 100/500. 0.3030 s / img. ETA=0:02:01
[12/07 09:55:09 c2.evaluation.evaluator]: Inference done 150/500. 0.3057 s / img. ETA=0:01:46
[12/07 09:55:24 c2.evaluation.evaluator]: Inference done 200/500. 0.3063 s / img. ETA=0:01:31
[12/07 09:55:39 c2.evaluation.evaluator]: Inference done 250/500. 0.3056 s / img. ETA=0:01:16
[12/07 09:55:55 c2.evaluation.evaluator]: Inference done 300/500. 0.3056 s / img. ETA=0:01:01
[12/07 09:56:10 c2.evaluation.evaluator]: Inference done 350/500. 0.3044 s / img. ETA=0:00:45
[12/07 09:56:24 c2.evaluation.evaluator]: Inference done 400/500. 0.3026 s / img. ETA=0:00:30
[12/07 09:56:38 c2.evaluation.evaluator]: Inference done 450/500. 0.3010 s / img. ETA=0:00:15
[12/07 09:56:52 c2.evaluation.evaluator]: Inference done 500/500. 0.2987 s / img. ETA=0:00:00
[12/07 09:56:52 c2.evaluation.evaluator]: Total inference time: 0:02:27 (0.296970 s / img per device, on 1 devices)
[12/07 09:56:52 c2.evaluation.evaluator]: Total inference pure compute time: 0:00:54 (0.110387 s / img per device, on 1 devices)
[12/07 09:56:52 c2.evaluation.sem_seg_evaluation]: OrderedDict([('sem_seg', {'mIoU': 74.35877634663952, 'fwIoU': 92.28441742512888, 'mACC': 82.39060201382804, 'pACC': 95.8319404916481})])
[12/07 09:56:52 c2.engine.custom]: Evaluation results for cityscapes_fine_sem_seg_val in csv format:
[12/07 09:56:52 c2.evaluation.testing]: copypaste: Task: sem_seg
[12/07 09:56:52 c2.evaluation.testing]: copypaste: mIoU,fwIoU,mACC,pACC
[12/07 09:56:52 c2.evaluation.testing]: copypaste: 74.3588,92.2844,82.3906,95.8319
naive test results in ms: avg: 77.532 max: 77.941 min: 77.168
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   94765 KB |  619053 KB |     793 GB |     793 GB |
|       from large pool |   24576 KB |  548864 KB |     786 GB |     786 GB |
|       from small pool |   70189 KB |   72237 KB |       6 GB |       6 GB |
|---------------------------------------------------------------------------|
| Active memory         |   94765 KB |  619053 KB |     793 GB |     793 GB |
|       from large pool |   24576 KB |  548864 KB |     786 GB |     786 GB |
|       from small pool |   70189 KB |   72237 KB |       6 GB |       6 GB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  643072 KB |  643072 KB |  546816 KB |       0 B  |
|       from large pool |  569344 KB |  569344 KB |  544768 KB |       0 B  |
|       from small pool |   73728 KB |   73728 KB |    2048 KB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1491 KB |  271827 KB |     776 GB |     776 GB |
|       from large pool |       0 KB |  270336 KB |     768 GB |     768 GB |
|       from small pool |    1491 KB |    3538 KB |       8 GB |       8 GB |
|---------------------------------------------------------------------------|
| Allocations           |    1935    |    1957    |   85800    |   85800    |
|       from large pool |       1    |      19    |   39380    |   39380    |
|       from small pool |    1934    |    1939    |   46420    |   46420    |
|---------------------------------------------------------------------------|
| Active allocs         |    1935    |    1957    |   85800    |   85800    |
|       from large pool |       1    |      19    |   39380    |   39380    |
|       from small pool |    1934    |    1939    |   46420    |   46420    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      42    |      42    |       6    |       0    |
|       from large pool |       6    |       6    |       5    |       0    |
|       from small pool |      36    |      36    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |      10    |   45650    |   45650    |
|       from large pool |       0    |       8    |   24365    |   24365    |
|       from small pool |       1    |       3    |   21285    |   21285    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before profile
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   84487 KB |   84487 KB |       0 B  |       0 B  |
|       from large pool |   53983 KB |   53983 KB |       0 B  |       0 B  |
|       from small pool |   30504 KB |   30504 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   84487 KB |   84487 KB |       0 B  |       0 B  |
|       from large pool |   53983 KB |   53983 KB |       0 B  |       0 B  |
|       from small pool |   30504 KB |   30504 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  643072 KB |  643072 KB |       0 B  |       0 B  |
|       from large pool |  569344 KB |  569344 KB |       0 B  |       0 B  |
|       from small pool |   73728 KB |   73728 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  124409 KB |  124409 KB |       0 B  |       0 B  |
|       from large pool |  122145 KB |  122145 KB |       0 B  |       0 B  |
|       from small pool |    2264 KB |    2264 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Allocations           |     177    |     177    |       0    |       0    |
|       from large pool |      15    |      15    |       0    |       0    |
|       from small pool |     162    |     162    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     177    |     177    |       0    |       0    |
|       from large pool |      15    |      15    |       0    |       0    |
|       from small pool |     162    |     162    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      42    |      42    |       0    |       0    |
|       from large pool |       6    |       6    |       0    |       0    |
|       from small pool |      36    |      36    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      18    |      18    |       0    |       0    |
|       from large pool |       2    |       2    |       0    |       0    |
|       from small pool |      16    |      16    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

PredictorMemoryPlanPass test results in ms: avg: 103.379 max: 103.708 min: 102.966
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   84487 KB |  349711 KB |  765454 MB |  765454 MB |
|       from large pool |   53983 KB |  319207 KB |  758864 MB |  758864 MB |
|       from small pool |   30504 KB |   32552 KB |    6589 MB |    6589 MB |
|---------------------------------------------------------------------------|
| Active memory         |   84487 KB |  349711 KB |  765454 MB |  765454 MB |
|       from large pool |   53983 KB |  319207 KB |  758864 MB |  758864 MB |
|       from small pool |   30504 KB |   32552 KB |    6589 MB |    6589 MB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  643072 KB |  643072 KB |       0 B  |       0 B  |
|       from large pool |  569344 KB |  569344 KB |       0 B  |       0 B  |
|       from small pool |   73728 KB |   73728 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  124409 KB |  230905 KB |  756870 MB |  756870 MB |
|       from large pool |  122145 KB |  228641 KB |  749620 MB |  749620 MB |
|       from small pool |    2264 KB |    3800 KB |    7249 MB |    7249 MB |
|---------------------------------------------------------------------------|
| Allocations           |     177    |     187    |   79200    |   79200    |
|       from large pool |      15    |      24    |   34650    |   34650    |
|       from small pool |     162    |     165    |   44550    |   44550    |
|---------------------------------------------------------------------------|
| Active allocs         |     177    |     187    |   79200    |   79200    |
|       from large pool |      15    |      24    |   34650    |   34650    |
|       from small pool |     162    |     165    |   44550    |   44550    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      42    |      42    |       0    |       0    |
|       from large pool |       6    |       6    |       0    |       0    |
|       from small pool |      36    |      36    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      18    |      23    |   48510    |   48510    |
|       from large pool |       2    |       7    |   18370    |   18370    |
|       from small pool |      16    |      17    |   30140    |   30140    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

bash run_benchmark.sh --arch B  --benchmark memory_plan --memory-mode on_demand
['.', '/home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing', '/home/v-weihaocui/brainstorm_project/brainstorm/3rdparty/tvm/python', '/home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python38.zip', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/lib-dynload', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages', '/home/v-weihaocui/brainstorm_project/brainstorm/python', '/home/v-weihaocui/brainstorm_project/brainstorm/3rdparty/dynamic_routing', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pycocotools-2.0.6-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/portalocker-2.6.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard-2.11.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/shapely-2.0rc1-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/matplotlib-3.6.2-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tabulate-0.9.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/termcolor-2.1.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/wheel-0.38.4-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/Werkzeug-2.2.2-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard_plugin_wit-1.8.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard_data_server-0.6.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/Markdown-3.4.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/grpcio-1.51.1-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/google_auth-2.14.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/google_auth_oauthlib-0.4.6-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/absl_py-1.3.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/kiwisolver-1.4.4-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/fonttools-4.38.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/cycler-0.11.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/contourpy-1.0.6-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/rsa-4.9-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pyasn1_modules-0.3.0rc1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/cachetools-5.2.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/requests_oauthlib-1.3.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pyasn1-0.5.0rc2-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/oauthlib-3.2.2-py3.8.egg']
Command Line Args: Namespace(arch='B', benchmark=['memory_plan'], debug=False, dist_url='tcp://127.0.0.1:62896', eval_only=False, machine_rank=0, memory_mode='on_demand', num_gpus=1, num_machines=1, opts=[], resume=False)
[12/07 09:57:24 dl_lib]: Rank of current process: 0. World size: 1
[12/07 09:57:24 dl_lib]: Command line arguments: Namespace(arch='B', benchmark=['memory_plan'], debug=False, dist_url='tcp://127.0.0.1:62896', eval_only=False, machine_rank=0, memory_mode='on_demand', num_gpus=1, num_machines=1, opts=[], resume=False)
[12/07 09:57:26 c2.utils.checkpoint]: Loading checkpoint from /home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing/../../.cache/ckpt/dynamic_routing/dynamic_B_miou74_3.pth
[12/07 09:57:27 c2.data.detection_utils]: TransformGens used: [ResizeShortestEdge(short_edge_length=(1024, 1024), max_size=2048, sample_style='choice')]
[12/07 09:57:27 c2.evaluation.evaluator]: Start inference on 500 images
[12/07 09:57:44 c2.evaluation.evaluator]: Inference done 50/500. 0.3032 s / img. ETA=0:02:16
[12/07 09:57:59 c2.evaluation.evaluator]: Inference done 100/500. 0.3016 s / img. ETA=0:02:00
[12/07 09:58:15 c2.evaluation.evaluator]: Inference done 150/500. 0.3027 s / img. ETA=0:01:45
[12/07 09:58:30 c2.evaluation.evaluator]: Inference done 200/500. 0.3045 s / img. ETA=0:01:31
[12/07 09:58:45 c2.evaluation.evaluator]: Inference done 250/500. 0.3050 s / img. ETA=0:01:16
[12/07 09:59:01 c2.evaluation.evaluator]: Inference done 300/500. 0.3057 s / img. ETA=0:01:01
[12/07 09:59:16 c2.evaluation.evaluator]: Inference done 350/500. 0.3050 s / img. ETA=0:00:45
[12/07 09:59:31 c2.evaluation.evaluator]: Inference done 400/500. 0.3042 s / img. ETA=0:00:30
[12/07 09:59:46 c2.evaluation.evaluator]: Inference done 450/500. 0.3029 s / img. ETA=0:00:15
[12/07 09:59:59 c2.evaluation.evaluator]: Inference done 500/500. 0.3000 s / img. ETA=0:00:00
[12/07 09:59:59 c2.evaluation.evaluator]: Total inference time: 0:02:28 (0.298990 s / img per device, on 1 devices)
[12/07 09:59:59 c2.evaluation.evaluator]: Total inference pure compute time: 0:00:54 (0.110516 s / img per device, on 1 devices)
[12/07 09:59:59 c2.evaluation.sem_seg_evaluation]: OrderedDict([('sem_seg', {'mIoU': 74.35877634663952, 'fwIoU': 92.28441742512888, 'mACC': 82.39060201382804, 'pACC': 95.8319404916481})])
[12/07 09:59:59 c2.engine.custom]: Evaluation results for cityscapes_fine_sem_seg_val in csv format:
[12/07 09:59:59 c2.evaluation.testing]: copypaste: Task: sem_seg
[12/07 09:59:59 c2.evaluation.testing]: copypaste: mIoU,fwIoU,mACC,pACC
[12/07 09:59:59 c2.evaluation.testing]: copypaste: 74.3588,92.2844,82.3906,95.8319
naive test results in ms: avg: 76.696 max: 78.046 min: 74.981
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   94765 KB |  619053 KB |     793 GB |     793 GB |
|       from large pool |   24576 KB |  548864 KB |     786 GB |     786 GB |
|       from small pool |   70189 KB |   72237 KB |       6 GB |       6 GB |
|---------------------------------------------------------------------------|
| Active memory         |   94765 KB |  619053 KB |     793 GB |     793 GB |
|       from large pool |   24576 KB |  548864 KB |     786 GB |     786 GB |
|       from small pool |   70189 KB |   72237 KB |       6 GB |       6 GB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  643072 KB |  643072 KB |  546816 KB |       0 B  |
|       from large pool |  569344 KB |  569344 KB |  544768 KB |       0 B  |
|       from small pool |   73728 KB |   73728 KB |    2048 KB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1491 KB |  271827 KB |     776 GB |     776 GB |
|       from large pool |       0 KB |  270336 KB |     768 GB |     768 GB |
|       from small pool |    1491 KB |    3538 KB |       8 GB |       8 GB |
|---------------------------------------------------------------------------|
| Allocations           |    1935    |    1957    |   85800    |   85800    |
|       from large pool |       1    |      19    |   39380    |   39380    |
|       from small pool |    1934    |    1939    |   46420    |   46420    |
|---------------------------------------------------------------------------|
| Active allocs         |    1935    |    1957    |   85800    |   85800    |
|       from large pool |       1    |      19    |   39380    |   39380    |
|       from small pool |    1934    |    1939    |   46420    |   46420    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      42    |      42    |       6    |       0    |
|       from large pool |       6    |       6    |       5    |       0    |
|       from small pool |      36    |      36    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |      10    |   45650    |   45650    |
|       from large pool |       0    |       8    |   24365    |   24365    |
|       from small pool |       1    |       3    |   21285    |   21285    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before profile
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   84487 KB |   84487 KB |       0 B  |       0 B  |
|       from large pool |   53983 KB |   53983 KB |       0 B  |       0 B  |
|       from small pool |   30504 KB |   30504 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   84487 KB |   84487 KB |       0 B  |       0 B  |
|       from large pool |   53983 KB |   53983 KB |       0 B  |       0 B  |
|       from small pool |   30504 KB |   30504 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  643072 KB |  643072 KB |       0 B  |       0 B  |
|       from large pool |  569344 KB |  569344 KB |       0 B  |       0 B  |
|       from small pool |   73728 KB |   73728 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  124409 KB |  124409 KB |       0 B  |       0 B  |
|       from large pool |  122145 KB |  122145 KB |       0 B  |       0 B  |
|       from small pool |    2264 KB |    2264 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Allocations           |     177    |     177    |       0    |       0    |
|       from large pool |      15    |      15    |       0    |       0    |
|       from small pool |     162    |     162    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     177    |     177    |       0    |       0    |
|       from large pool |      15    |      15    |       0    |       0    |
|       from small pool |     162    |     162    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      42    |      42    |       0    |       0    |
|       from large pool |       6    |       6    |       0    |       0    |
|       from small pool |      36    |      36    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      18    |      18    |       0    |       0    |
|       from large pool |       2    |       2    |       0    |       0    |
|       from small pool |      16    |      16    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

OnDemandMemoryPlanPass test results in ms: avg: 102.619 max: 103.057 min: 102.063
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   84487 KB |  349711 KB |  765454 MB |  765454 MB |
|       from large pool |   53983 KB |  319207 KB |  758864 MB |  758864 MB |
|       from small pool |   30504 KB |   32552 KB |    6589 MB |    6589 MB |
|---------------------------------------------------------------------------|
| Active memory         |   84487 KB |  349711 KB |  765454 MB |  765454 MB |
|       from large pool |   53983 KB |  319207 KB |  758864 MB |  758864 MB |
|       from small pool |   30504 KB |   32552 KB |    6589 MB |    6589 MB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  643072 KB |  643072 KB |       0 B  |       0 B  |
|       from large pool |  569344 KB |  569344 KB |       0 B  |       0 B  |
|       from small pool |   73728 KB |   73728 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  124409 KB |  230905 KB |  756870 MB |  756870 MB |
|       from large pool |  122145 KB |  228641 KB |  749620 MB |  749620 MB |
|       from small pool |    2264 KB |    3800 KB |    7249 MB |    7249 MB |
|---------------------------------------------------------------------------|
| Allocations           |     177    |     187    |   79200    |   79200    |
|       from large pool |      15    |      24    |   34650    |   34650    |
|       from small pool |     162    |     165    |   44550    |   44550    |
|---------------------------------------------------------------------------|
| Active allocs         |     177    |     187    |   79200    |   79200    |
|       from large pool |      15    |      24    |   34650    |   34650    |
|       from small pool |     162    |     165    |   44550    |   44550    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      42    |      42    |       0    |       0    |
|       from large pool |       6    |       6    |       0    |       0    |
|       from small pool |      36    |      36    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      18    |      23    |   48510    |   48510    |
|       from large pool |       2    |       7    |   18370    |   18370    |
|       from small pool |      16    |      17    |   30140    |   30140    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

bash run_benchmark.sh --arch C  --benchmark memory_plan --memory-mode predict
['.', '/home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing', '/home/v-weihaocui/brainstorm_project/brainstorm/3rdparty/tvm/python', '/home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python38.zip', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/lib-dynload', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages', '/home/v-weihaocui/brainstorm_project/brainstorm/python', '/home/v-weihaocui/brainstorm_project/brainstorm/3rdparty/dynamic_routing', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pycocotools-2.0.6-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/portalocker-2.6.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard-2.11.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/shapely-2.0rc1-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/matplotlib-3.6.2-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tabulate-0.9.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/termcolor-2.1.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/wheel-0.38.4-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/Werkzeug-2.2.2-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard_plugin_wit-1.8.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard_data_server-0.6.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/Markdown-3.4.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/grpcio-1.51.1-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/google_auth-2.14.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/google_auth_oauthlib-0.4.6-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/absl_py-1.3.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/kiwisolver-1.4.4-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/fonttools-4.38.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/cycler-0.11.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/contourpy-1.0.6-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/rsa-4.9-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pyasn1_modules-0.3.0rc1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/cachetools-5.2.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/requests_oauthlib-1.3.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pyasn1-0.5.0rc2-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/oauthlib-3.2.2-py3.8.egg']
Command Line Args: Namespace(arch='C', benchmark=['memory_plan'], debug=False, dist_url='tcp://127.0.0.1:62896', eval_only=False, machine_rank=0, memory_mode='predict', num_gpus=1, num_machines=1, opts=[], resume=False)
[12/07 10:00:30 dl_lib]: Rank of current process: 0. World size: 1
[12/07 10:00:30 dl_lib]: Command line arguments: Namespace(arch='C', benchmark=['memory_plan'], debug=False, dist_url='tcp://127.0.0.1:62896', eval_only=False, machine_rank=0, memory_mode='predict', num_gpus=1, num_machines=1, opts=[], resume=False)
[12/07 10:00:32 c2.utils.checkpoint]: Loading checkpoint from /home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing/../../.cache/ckpt/dynamic_routing/dynamic_C_miou74_8.pth
[12/07 10:00:34 c2.data.detection_utils]: TransformGens used: [ResizeShortestEdge(short_edge_length=(1024, 1024), max_size=2048, sample_style='choice')]
[12/07 10:00:34 c2.evaluation.evaluator]: Start inference on 500 images
[12/07 10:00:51 c2.evaluation.evaluator]: Inference done 50/500. 0.2905 s / img. ETA=0:02:10
[12/07 10:01:05 c2.evaluation.evaluator]: Inference done 100/500. 0.2916 s / img. ETA=0:01:56
[12/07 10:01:20 c2.evaluation.evaluator]: Inference done 150/500. 0.2907 s / img. ETA=0:01:41
[12/07 10:01:35 c2.evaluation.evaluator]: Inference done 200/500. 0.2934 s / img. ETA=0:01:28
[12/07 10:01:51 c2.evaluation.evaluator]: Inference done 250/500. 0.2988 s / img. ETA=0:01:14
[12/07 10:02:06 c2.evaluation.evaluator]: Inference done 300/500. 0.3010 s / img. ETA=0:01:00
[12/07 10:02:22 c2.evaluation.evaluator]: Inference done 350/500. 0.3041 s / img. ETA=0:00:45
[12/07 10:02:38 c2.evaluation.evaluator]: Inference done 400/500. 0.3048 s / img. ETA=0:00:30
[12/07 10:02:53 c2.evaluation.evaluator]: Inference done 450/500. 0.3049 s / img. ETA=0:00:15
[12/07 10:03:07 c2.evaluation.evaluator]: Inference done 500/500. 0.3025 s / img. ETA=0:00:00
[12/07 10:03:07 c2.evaluation.evaluator]: Total inference time: 0:02:29 (0.301010 s / img per device, on 1 devices)
[12/07 10:03:07 c2.evaluation.evaluator]: Total inference pure compute time: 0:00:54 (0.110820 s / img per device, on 1 devices)
[12/07 10:03:07 c2.evaluation.sem_seg_evaluation]: OrderedDict([('sem_seg', {'mIoU': 74.6714742274145, 'fwIoU': 92.10367921096194, 'mACC': 82.21919547860679, 'pACC': 95.736209932376})])
[12/07 10:03:07 c2.engine.custom]: Evaluation results for cityscapes_fine_sem_seg_val in csv format:
[12/07 10:03:07 c2.evaluation.testing]: copypaste: Task: sem_seg
[12/07 10:03:07 c2.evaluation.testing]: copypaste: mIoU,fwIoU,mACC,pACC
[12/07 10:03:07 c2.evaluation.testing]: copypaste: 74.6715,92.1037,82.2192,95.7362
naive test results in ms: avg: 78.050 max: 78.751 min: 77.398
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   94765 KB |  619053 KB |     808 GB |     808 GB |
|       from large pool |   24576 KB |  548864 KB |     801 GB |     801 GB |
|       from small pool |   70189 KB |   72237 KB |       6 GB |       6 GB |
|---------------------------------------------------------------------------|
| Active memory         |   94765 KB |  619053 KB |     808 GB |     808 GB |
|       from large pool |   24576 KB |  548864 KB |     801 GB |     801 GB |
|       from small pool |   70189 KB |   72237 KB |       6 GB |       6 GB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  643072 KB |  643072 KB |  546816 KB |       0 B  |
|       from large pool |  569344 KB |  569344 KB |  544768 KB |       0 B  |
|       from small pool |   73728 KB |   73728 KB |    2048 KB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1491 KB |  325075 KB |     806 GB |     806 GB |
|       from large pool |       0 KB |  323584 KB |     798 GB |     798 GB |
|       from small pool |    1491 KB |    3538 KB |       8 GB |       8 GB |
|---------------------------------------------------------------------------|
| Allocations           |    1935    |    1958    |   86735    |   86735    |
|       from large pool |       1    |      20    |   40645    |   40645    |
|       from small pool |    1934    |    1939    |   46090    |   46090    |
|---------------------------------------------------------------------------|
| Active allocs         |    1935    |    1958    |   86735    |   86735    |
|       from large pool |       1    |      20    |   40645    |   40645    |
|       from small pool |    1934    |    1939    |   46090    |   46090    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      42    |      42    |       6    |       0    |
|       from large pool |       6    |       6    |       5    |       0    |
|       from small pool |      36    |      36    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |      11    |   44990    |   44990    |
|       from large pool |       0    |       9    |   23925    |   23925    |
|       from small pool |       1    |       3    |   21065    |   21065    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before profile
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   84487 KB |   84487 KB |       0 B  |       0 B  |
|       from large pool |   53983 KB |   53983 KB |       0 B  |       0 B  |
|       from small pool |   30504 KB |   30504 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   84487 KB |   84487 KB |       0 B  |       0 B  |
|       from large pool |   53983 KB |   53983 KB |       0 B  |       0 B  |
|       from small pool |   30504 KB |   30504 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  643072 KB |  643072 KB |       0 B  |       0 B  |
|       from large pool |  569344 KB |  569344 KB |       0 B  |       0 B  |
|       from small pool |   73728 KB |   73728 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  124409 KB |  124409 KB |       0 B  |       0 B  |
|       from large pool |  122145 KB |  122145 KB |       0 B  |       0 B  |
|       from small pool |    2264 KB |    2264 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Allocations           |     177    |     177    |       0    |       0    |
|       from large pool |      15    |      15    |       0    |       0    |
|       from small pool |     162    |     162    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     177    |     177    |       0    |       0    |
|       from large pool |      15    |      15    |       0    |       0    |
|       from small pool |     162    |     162    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      42    |      42    |       0    |       0    |
|       from large pool |       6    |       6    |       0    |       0    |
|       from small pool |      36    |      36    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      18    |      18    |       0    |       0    |
|       from large pool |       2    |       2    |       0    |       0    |
|       from small pool |      16    |      16    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

PredictorMemoryPlanPass test results in ms: avg: 102.711 max: 104.762 min: 101.368
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   84487 KB |  349711 KB |  760516 MB |  760516 MB |
|       from large pool |   53983 KB |  319207 KB |  753776 MB |  753776 MB |
|       from small pool |   30504 KB |   32552 KB |    6739 MB |    6739 MB |
|---------------------------------------------------------------------------|
| Active memory         |   84487 KB |  349711 KB |  760516 MB |  760516 MB |
|       from large pool |   53983 KB |  319207 KB |  753776 MB |  753776 MB |
|       from small pool |   30504 KB |   32552 KB |    6739 MB |    6739 MB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  643072 KB |  643072 KB |       0 B  |       0 B  |
|       from large pool |  569344 KB |  569344 KB |       0 B  |       0 B  |
|       from small pool |   73728 KB |   73728 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  124409 KB |  223737 KB |  719871 MB |  719871 MB |
|       from large pool |  122145 KB |  220449 KB |  712416 MB |  712416 MB |
|       from small pool |    2264 KB |    3800 KB |    7454 MB |    7454 MB |
|---------------------------------------------------------------------------|
| Allocations           |     177    |     187    |   79145    |   79145    |
|       from large pool |      15    |      24    |   33990    |   33990    |
|       from small pool |     162    |     165    |   45155    |   45155    |
|---------------------------------------------------------------------------|
| Active allocs         |     177    |     187    |   79145    |   79145    |
|       from large pool |      15    |      24    |   33990    |   33990    |
|       from small pool |     162    |     165    |   45155    |   45155    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      42    |      42    |       0    |       0    |
|       from large pool |       6    |       6    |       0    |       0    |
|       from small pool |      36    |      36    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      18    |      23    |   46530    |   46530    |
|       from large pool |       2    |       7    |   16170    |   16170    |
|       from small pool |      16    |      17    |   30360    |   30360    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

bash run_benchmark.sh --arch C  --benchmark memory_plan --memory-mode on_demand
['.', '/home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing', '/home/v-weihaocui/brainstorm_project/brainstorm/3rdparty/tvm/python', '/home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python38.zip', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/lib-dynload', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages', '/home/v-weihaocui/brainstorm_project/brainstorm/python', '/home/v-weihaocui/brainstorm_project/brainstorm/3rdparty/dynamic_routing', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pycocotools-2.0.6-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/portalocker-2.6.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard-2.11.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/shapely-2.0rc1-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/matplotlib-3.6.2-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tabulate-0.9.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/termcolor-2.1.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/wheel-0.38.4-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/Werkzeug-2.2.2-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard_plugin_wit-1.8.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard_data_server-0.6.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/Markdown-3.4.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/grpcio-1.51.1-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/google_auth-2.14.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/google_auth_oauthlib-0.4.6-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/absl_py-1.3.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/kiwisolver-1.4.4-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/fonttools-4.38.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/cycler-0.11.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/contourpy-1.0.6-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/rsa-4.9-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pyasn1_modules-0.3.0rc1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/cachetools-5.2.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/requests_oauthlib-1.3.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pyasn1-0.5.0rc2-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/oauthlib-3.2.2-py3.8.egg']
Command Line Args: Namespace(arch='C', benchmark=['memory_plan'], debug=False, dist_url='tcp://127.0.0.1:62896', eval_only=False, machine_rank=0, memory_mode='on_demand', num_gpus=1, num_machines=1, opts=[], resume=False)
[12/07 10:03:38 dl_lib]: Rank of current process: 0. World size: 1
[12/07 10:03:38 dl_lib]: Command line arguments: Namespace(arch='C', benchmark=['memory_plan'], debug=False, dist_url='tcp://127.0.0.1:62896', eval_only=False, machine_rank=0, memory_mode='on_demand', num_gpus=1, num_machines=1, opts=[], resume=False)
[12/07 10:03:40 c2.utils.checkpoint]: Loading checkpoint from /home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing/../../.cache/ckpt/dynamic_routing/dynamic_C_miou74_8.pth
[12/07 10:03:41 c2.data.detection_utils]: TransformGens used: [ResizeShortestEdge(short_edge_length=(1024, 1024), max_size=2048, sample_style='choice')]
[12/07 10:03:42 c2.evaluation.evaluator]: Start inference on 500 images
[12/07 10:03:57 c2.evaluation.evaluator]: Inference done 50/500. 0.2727 s / img. ETA=0:02:02
[12/07 10:04:11 c2.evaluation.evaluator]: Inference done 100/500. 0.2757 s / img. ETA=0:01:50
[12/07 10:04:27 c2.evaluation.evaluator]: Inference done 150/500. 0.2895 s / img. ETA=0:01:41
[12/07 10:04:42 c2.evaluation.evaluator]: Inference done 200/500. 0.2956 s / img. ETA=0:01:28
[12/07 10:04:58 c2.evaluation.evaluator]: Inference done 250/500. 0.2986 s / img. ETA=0:01:14
[12/07 10:05:13 c2.evaluation.evaluator]: Inference done 300/500. 0.2994 s / img. ETA=0:00:59
[12/07 10:05:28 c2.evaluation.evaluator]: Inference done 350/500. 0.2991 s / img. ETA=0:00:44
[12/07 10:05:44 c2.evaluation.evaluator]: Inference done 400/500. 0.3011 s / img. ETA=0:00:30
[12/07 10:05:59 c2.evaluation.evaluator]: Inference done 450/500. 0.3012 s / img. ETA=0:00:15
[12/07 10:06:13 c2.evaluation.evaluator]: Inference done 500/500. 0.2987 s / img. ETA=0:00:00
[12/07 10:06:13 c2.evaluation.evaluator]: Total inference time: 0:02:27 (0.296970 s / img per device, on 1 devices)
[12/07 10:06:13 c2.evaluation.evaluator]: Total inference pure compute time: 0:00:54 (0.110516 s / img per device, on 1 devices)
[12/07 10:06:13 c2.evaluation.sem_seg_evaluation]: OrderedDict([('sem_seg', {'mIoU': 74.6714742274145, 'fwIoU': 92.10367921096194, 'mACC': 82.21919547860679, 'pACC': 95.736209932376})])
[12/07 10:06:13 c2.engine.custom]: Evaluation results for cityscapes_fine_sem_seg_val in csv format:
[12/07 10:06:13 c2.evaluation.testing]: copypaste: Task: sem_seg
[12/07 10:06:13 c2.evaluation.testing]: copypaste: mIoU,fwIoU,mACC,pACC
[12/07 10:06:13 c2.evaluation.testing]: copypaste: 74.6715,92.1037,82.2192,95.7362
naive test results in ms: avg: 76.566 max: 77.148 min: 75.743
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   94765 KB |  619053 KB |     808 GB |     808 GB |
|       from large pool |   24576 KB |  548864 KB |     801 GB |     801 GB |
|       from small pool |   70189 KB |   72237 KB |       6 GB |       6 GB |
|---------------------------------------------------------------------------|
| Active memory         |   94765 KB |  619053 KB |     808 GB |     808 GB |
|       from large pool |   24576 KB |  548864 KB |     801 GB |     801 GB |
|       from small pool |   70189 KB |   72237 KB |       6 GB |       6 GB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  643072 KB |  643072 KB |  546816 KB |       0 B  |
|       from large pool |  569344 KB |  569344 KB |  544768 KB |       0 B  |
|       from small pool |   73728 KB |   73728 KB |    2048 KB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1491 KB |  325075 KB |     806 GB |     806 GB |
|       from large pool |       0 KB |  323584 KB |     798 GB |     798 GB |
|       from small pool |    1491 KB |    3538 KB |       8 GB |       8 GB |
|---------------------------------------------------------------------------|
| Allocations           |    1935    |    1958    |   86735    |   86735    |
|       from large pool |       1    |      20    |   40645    |   40645    |
|       from small pool |    1934    |    1939    |   46090    |   46090    |
|---------------------------------------------------------------------------|
| Active allocs         |    1935    |    1958    |   86735    |   86735    |
|       from large pool |       1    |      20    |   40645    |   40645    |
|       from small pool |    1934    |    1939    |   46090    |   46090    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      42    |      42    |       6    |       0    |
|       from large pool |       6    |       6    |       5    |       0    |
|       from small pool |      36    |      36    |       1    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |      11    |   44990    |   44990    |
|       from large pool |       0    |       9    |   23925    |   23925    |
|       from small pool |       1    |       3    |   21065    |   21065    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before profile
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   84487 KB |   84487 KB |       0 B  |       0 B  |
|       from large pool |   53983 KB |   53983 KB |       0 B  |       0 B  |
|       from small pool |   30504 KB |   30504 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   84487 KB |   84487 KB |       0 B  |       0 B  |
|       from large pool |   53983 KB |   53983 KB |       0 B  |       0 B  |
|       from small pool |   30504 KB |   30504 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  643072 KB |  643072 KB |       0 B  |       0 B  |
|       from large pool |  569344 KB |  569344 KB |       0 B  |       0 B  |
|       from small pool |   73728 KB |   73728 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  124409 KB |  124409 KB |       0 B  |       0 B  |
|       from large pool |  122145 KB |  122145 KB |       0 B  |       0 B  |
|       from small pool |    2264 KB |    2264 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Allocations           |     177    |     177    |       0    |       0    |
|       from large pool |      15    |      15    |       0    |       0    |
|       from small pool |     162    |     162    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     177    |     177    |       0    |       0    |
|       from large pool |      15    |      15    |       0    |       0    |
|       from small pool |     162    |     162    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      42    |      42    |       0    |       0    |
|       from large pool |       6    |       6    |       0    |       0    |
|       from small pool |      36    |      36    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      18    |      18    |       0    |       0    |
|       from large pool |       2    |       2    |       0    |       0    |
|       from small pool |      16    |      16    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

OnDemandMemoryPlanPass test results in ms: avg: 102.057 max: 102.347 min: 101.790
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   84487 KB |  349711 KB |  760516 MB |  760516 MB |
|       from large pool |   53983 KB |  319207 KB |  753776 MB |  753776 MB |
|       from small pool |   30504 KB |   32552 KB |    6739 MB |    6739 MB |
|---------------------------------------------------------------------------|
| Active memory         |   84487 KB |  349711 KB |  760516 MB |  760516 MB |
|       from large pool |   53983 KB |  319207 KB |  753776 MB |  753776 MB |
|       from small pool |   30504 KB |   32552 KB |    6739 MB |    6739 MB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  643072 KB |  643072 KB |       0 B  |       0 B  |
|       from large pool |  569344 KB |  569344 KB |       0 B  |       0 B  |
|       from small pool |   73728 KB |   73728 KB |       0 B  |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |  124409 KB |  223737 KB |  719871 MB |  719871 MB |
|       from large pool |  122145 KB |  220449 KB |  712416 MB |  712416 MB |
|       from small pool |    2264 KB |    3800 KB |    7454 MB |    7454 MB |
|---------------------------------------------------------------------------|
| Allocations           |     177    |     187    |   79145    |   79145    |
|       from large pool |      15    |      24    |   33990    |   33990    |
|       from small pool |     162    |     165    |   45155    |   45155    |
|---------------------------------------------------------------------------|
| Active allocs         |     177    |     187    |   79145    |   79145    |
|       from large pool |      15    |      24    |   33990    |   33990    |
|       from small pool |     162    |     165    |   45155    |   45155    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      42    |      42    |       0    |       0    |
|       from large pool |       6    |       6    |       0    |       0    |
|       from small pool |      36    |      36    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      18    |      23    |   46530    |   46530    |
|       from large pool |       2    |       7    |   16170    |   16170    |
|       from small pool |      16    |      17    |   30360    |   30360    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

bash run_benchmark.sh --arch raw  --benchmark dce_memory_plan --memory-mode predict
['.', '/home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing', '/home/v-weihaocui/brainstorm_project/brainstorm/3rdparty/tvm/python', '/home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python38.zip', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/lib-dynload', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages', '/home/v-weihaocui/brainstorm_project/brainstorm/python', '/home/v-weihaocui/brainstorm_project/brainstorm/3rdparty/dynamic_routing', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pycocotools-2.0.6-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/portalocker-2.6.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard-2.11.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/shapely-2.0rc1-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/matplotlib-3.6.2-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tabulate-0.9.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/termcolor-2.1.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/wheel-0.38.4-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/Werkzeug-2.2.2-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard_plugin_wit-1.8.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/tensorboard_data_server-0.6.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/Markdown-3.4.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/grpcio-1.51.1-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/google_auth-2.14.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/google_auth_oauthlib-0.4.6-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/absl_py-1.3.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/kiwisolver-1.4.4-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/fonttools-4.38.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/cycler-0.11.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/contourpy-1.0.6-py3.8-linux-x86_64.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/rsa-4.9-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pyasn1_modules-0.3.0rc1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/cachetools-5.2.0-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/requests_oauthlib-1.3.1-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/pyasn1-0.5.0rc2-py3.8.egg', '/home/v-weihaocui/.pyenv/versions/miniconda3-3.8-4.10.3/lib/python3.8/site-packages/oauthlib-3.2.2-py3.8.egg']
Command Line Args: Namespace(arch='raw', benchmark=['dce_memory_plan'], debug=False, dist_url='tcp://127.0.0.1:62896', eval_only=False, machine_rank=0, memory_mode='predict', num_gpus=1, num_machines=1, opts=[], resume=False)
[12/07 10:06:44 dl_lib]: Rank of current process: 0. World size: 1
[12/07 10:06:44 dl_lib]: Command line arguments: Namespace(arch='raw', benchmark=['dce_memory_plan'], debug=False, dist_url='tcp://127.0.0.1:62896', eval_only=False, machine_rank=0, memory_mode='predict', num_gpus=1, num_machines=1, opts=[], resume=False)
[12/07 10:06:46 c2.utils.checkpoint]: Loading checkpoint from /home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing/../../.cache/ckpt/dynamic_routing/dynamic_raw_miou76_7.pth
[12/07 10:06:47 c2.data.detection_utils]: TransformGens used: [ResizeShortestEdge(short_edge_length=(1024, 1024), max_size=2048, sample_style='choice')]
[12/07 10:06:48 c2.evaluation.evaluator]: Start inference on 500 images
[12/07 10:07:06 c2.evaluation.evaluator]: Inference done 50/500. 0.3411 s / img. ETA=0:02:33
[12/07 10:07:23 c2.evaluation.evaluator]: Inference done 100/500. 0.3420 s / img. ETA=0:02:16
[12/07 10:07:41 c2.evaluation.evaluator]: Inference done 150/500. 0.3424 s / img. ETA=0:01:59
[12/07 10:07:58 c2.evaluation.evaluator]: Inference done 200/500. 0.3440 s / img. ETA=0:01:43
[12/07 10:08:15 c2.evaluation.evaluator]: Inference done 250/500. 0.3417 s / img. ETA=0:01:25
[12/07 10:08:31 c2.evaluation.evaluator]: Inference done 300/500. 0.3382 s / img. ETA=0:01:07
[12/07 10:08:47 c2.evaluation.evaluator]: Inference done 350/500. 0.3355 s / img. ETA=0:00:50
[12/07 10:09:03 c2.evaluation.evaluator]: Inference done 400/500. 0.3339 s / img. ETA=0:00:33
[12/07 10:09:19 c2.evaluation.evaluator]: Inference done 450/500. 0.3329 s / img. ETA=0:00:16
[12/07 10:09:35 c2.evaluation.evaluator]: Inference done 500/500. 0.3319 s / img. ETA=0:00:00
[12/07 10:09:35 c2.evaluation.evaluator]: Total inference time: 0:02:44 (0.331313 s / img per device, on 1 devices)
[12/07 10:09:35 c2.evaluation.evaluator]: Total inference pure compute time: 0:01:04 (0.130459 s / img per device, on 1 devices)
[12/07 10:09:36 c2.evaluation.sem_seg_evaluation]: OrderedDict([('sem_seg', {'mIoU': 76.66681621952162, 'fwIoU': 92.85563391131222, 'mACC': 84.68712574459461, 'pACC': 96.14714208097736})])
[12/07 10:09:36 c2.engine.custom]: Evaluation results for cityscapes_fine_sem_seg_val in csv format:
[12/07 10:09:36 c2.evaluation.testing]: copypaste: Task: sem_seg
[12/07 10:09:36 c2.evaluation.testing]: copypaste: mIoU,fwIoU,mACC,pACC
[12/07 10:09:36 c2.evaluation.testing]: copypaste: 76.6668,92.8556,84.6871,96.1471
naive0 test results in ms: avg: 95.535 max: 95.864 min: 95.088
naive test results in ms: avg: 97.191 max: 97.753 min: 95.636
dead_path_eliminated test results in ms: avg: 96.295 max: 96.755 min: 95.825
all_liveness_pass test results in ms: avg: 75.206 max: 75.338 min: 75.029
PredictorMemoryPlanPass test results in ms: avg: 96.609 max: 96.836 min: 96.411
--Return--
> /home/v-weihaocui/brainstorm_project/brainstorm/benchmark/dynamic_routing/benchmark.py(290)dce_memroy_plan_benchmark()->None
-> import pdb; pdb.set_trace()
(Pdb) --KeyboardInterrupt--
(Pdb) (Pdb) --KeyboardInterrupt--
(Pdb) (Pdb) (Pdb) (Pdb) --KeyboardInterrupt--
(Pdb) 